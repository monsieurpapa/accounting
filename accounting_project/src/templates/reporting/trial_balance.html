{% extends 'base.html' %}

{% block title %}Balance de vérification | Système de Comptabilité{% endblock %}

{% block page_title %}Balance de vérification{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'reporting:index' %}">Rapports</a></li>
<li class="breadcrumb-item active" aria-current="page">Balance de vérification</li>
{% endblock %}

{% block content %}
<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">Balance de vérification</h6>
        <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-download"></i> Exporter
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
                <li><a class="dropdown-item" href="#"><i class="bi bi-file-earmark-pdf"></i> PDF</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-file-earmark-excel"></i> Excel</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-printer"></i> Imprimer</a></li>
            </ul>
        </div>
    </div>
    <div class="card-body">
        <!-- Report Parameters -->
        <form id="reportForm" class="mb-4">
            <div class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label for="fiscalYear" class="form-label">Exercice fiscal</label>
                    <select class="form-select" id="fiscalYear" required>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="period" class="form-label">Période</label>
                    <select class="form-select" id="period">
                        <option value="">Toutes les périodes</option>
                        <option value="1">Janvier 2025</option>
                        <option value="2">Février 2025</option>
                        <option value="3">Mars 2025</option>
                        <option value="4">Avril 2025</option>
                        <option value="5" selected>Mai 2025</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="accountRange" class="form-label">Plage de comptes</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="accountRangeStart" placeholder="Début">
                        <span class="input-group-text">à</span>
                        <input type="text" class="form-control" id="accountRangeEnd" placeholder="Fin">
                    </div>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> Générer
                    </button>
                </div>
            </div>
        </form>

        <!-- Report Header -->
        <div class="report-header text-center mb-4">
            <h4>HÔPITAL GÉNÉRAL DE RÉFÉRENCE</h4>
            <h5>Balance de vérification</h5>
            <p>Période: Mai 2025</p>
        </div>

        <!-- Trial Balance Table -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                    <tr>
                        <th rowspan="2" class="align-middle">Code</th>
                        <th rowspan="2" class="align-middle">Intitulé du compte</th>
                        <th colspan="2" class="text-center">Soldes d'ouverture</th>
                        <th colspan="2" class="text-center">Mouvements de la période</th>
                        <th colspan="2" class="text-center">Soldes de clôture</th>
                    </tr>
                    <tr>
                        <th class="text-end">Débit</th>
                        <th class="text-end">Crédit</th>
                        <th class="text-end">Débit</th>
                        <th class="text-end">Crédit</th>
                        <th class="text-end">Débit</th>
                        <th class="text-end">Crédit</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Class 1 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 1: COMPTES DE RESSOURCES DURABLES</strong></td>
                    </tr>
                    <tr>
                        <td>10100</td>
                        <td>Capital social</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">5,000,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">5,000,000.00</td>
                    </tr>
                    <tr>
                        <td>10600</td>
                        <td>Réserves</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">1,200,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">1,200,000.00</td>
                    </tr>

                    <!-- Class 2 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 2: COMPTES D'ACTIFS IMMOBILISÉS</strong></td>
                    </tr>
                    <tr>
                        <td>21100</td>
                        <td>Terrains</td>
                        <td class="text-end">3,500,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">3,500,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>
                    <tr>
                        <td>22100</td>
                        <td>Bâtiments</td>
                        <td class="text-end">7,800,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">7,800,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>
                    <tr>
                        <td>24100</td>
                        <td>Matériel et mobilier</td>
                        <td class="text-end">2,300,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">2,300,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>

                    <!-- Class 4 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 4: COMPTES DE TIERS</strong></td>
                    </tr>
                    <tr>
                        <td>40100</td>
                        <td>Fournisseurs</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">1,200,000.00</td>
                        <td class="text-end">750,000.00</td>
                        <td class="text-end">1,000,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">1,450,000.00</td>
                    </tr>
                    <tr>
                        <td>41100</td>
                        <td>Clients</td>
                        <td class="text-end">1,850,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">1,250,000.00</td>
                        <td class="text-end">1,000,000.00</td>
                        <td class="text-end">2,100,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>

                    <!-- Class 5 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 5: COMPTES DE TRÉSORERIE</strong></td>
                    </tr>
                    <tr>
                        <td>52100</td>
                        <td>Banque</td>
                        <td class="text-end">3,000,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">4,000,000.00</td>
                        <td class="text-end">3,250,000.00</td>
                        <td class="text-end">3,750,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>
                    <tr>
                        <td>57100</td>
                        <td>Caisse</td>
                        <td class="text-end">400,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">450,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">850,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>

                    <!-- Class 6 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 6: COMPTES DE CHARGES</strong></td>
                    </tr>
                    <tr>
                        <td>60100</td>
                        <td>Achats de marchandises</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">4,200,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">4,200,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>
                    <tr>
                        <td>66100</td>
                        <td>Charges de personnel</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">3,100,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">3,100,000.00</td>
                        <td class="text-end">0.00</td>
                    </tr>

                    <!-- Class 7 -->
                    <tr class="table-secondary">
                        <td colspan="8"><strong>CLASSE 7: COMPTES DE PRODUITS</strong></td>
                    </tr>
                    <tr>
                        <td>70100</td>
                        <td>Ventes de marchandises</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">8,500,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">8,500,000.00</td>
                    </tr>
                    <tr>
                        <td>70600</td>
                        <td>Prestations de services</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">3,200,000.00</td>
                        <td class="text-end">0.00</td>
                        <td class="text-end">3,200,000.00</td>
                    </tr>

                    <!-- Totals -->
                    <tr class="table-primary fw-bold">
                        <td colspan="2" class="text-end">TOTAUX</td>
                        <td class="text-end">18,850,000.00</td>
                        <td class="text-end">7,400,000.00</td>
                        <td class="text-end">13,750,000.00</td>
                        <td class="text-end">16,950,000.00</td>
                        <td class="text-end">27,600,000.00</td>
                        <td class="text-end">19,350,000.00</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Report Footer -->
        <div class="report-footer mt-4">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Date de génération:</strong> 27/05/2025</p>
                </div>
                <div class="col-md-6 text-end">
                    <p><strong>Généré par:</strong> {{ request.user.get_full_name }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Print functionality
    document.querySelector('.dropdown-item[href="#"][title="Imprimer"]').addEventListener('click', function(e) {
        e.preventDefault();
        window.print();
    });
    
    // Form submission
    document.getElementById('reportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        // In a real implementation, this would trigger an AJAX request to refresh the report
        alert('Génération du rapport avec les nouveaux paramètres...');
    });
</script>
{% endblock %}
