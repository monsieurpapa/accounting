{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Entry Detail" %}: {{ entry.entry_number|default:entry.id }} | Système de Comptabilité{%
endblock %}

{% block page_title %}{% trans "Journal Entry Detail" %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'accounting:journal_entry_list' %}">{% trans "Journal Entries" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ entry.entry_number|default:entry.id }}</li>
{% endblock %}

{% block content %}
<div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
        <h6 class="m-0 font-weight-bold text-primary">{% trans "Entry Information" %}</h6>
        <div class="btn-group">
            <a href="{% url 'accounting:journal_entry_list' %}" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> {% trans "Back" %}
            </a>
            {% if not entry.posted %}
            <a href="{% url 'accounting:journal_entry_post' entry.uuid %}" class="btn btn-sm btn-success">
                <i class="bi bi-check-all"></i> {% trans "Post Transaction" %}
            </a>
            <a href="{% url 'accounting:journal_entry_edit' entry.uuid %}" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-pencil"></i> {% trans "Edit" %}
            </a>
            <a href="{% url 'accounting:journal_entry_delete' entry.uuid %}" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-trash"></i> {% trans "Delete" %}
            </a>
            {% else %}
            <span class="badge bg-success p-2">
                <i class="bi bi-lock-fill"></i> {% trans "POSTED & LOCKED" %}
            </span>
            {% endif %}
        </div>
    </div>
    <div class="card-body">
        <div class="row mb-4">
            <div class="col-md-3">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Entry Number" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">{{ entry.entry_number|default:entry.id }}</p>
            </div>
            <div class="col-md-3">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Date" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">{{ entry.date|date:"d/m/Y" }}</p>
            </div>
            <div class="col-md-3">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Journal" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">{{ entry.journal.name }}</p>
            </div>
            <div class="col-md-3">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Status" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">
                    {% if entry.posted %}
                    <span class="badge bg-success">{% trans "Posted" %}</span>
                    {% else %}
                    <span class="badge bg-warning">{% trans "Draft" %}</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Reference" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">{{ entry.reference|default:"--" }}</p>
            </div>
            <div class="col-md-6">
                <p class="text-xs text-uppercase font-weight-bold text-muted mb-1">{% trans "Description" %}</p>
                <p class="h5 mb-0 font-weight-bold text-gray-800">{{ entry.description|default:"--" }}</p>
            </div>
        </div>

        <div class="table-responsive mt-5">
            <table class="table table-bordered align-middle">
                <thead class="bg-light">
                    <tr>
                        <th>{% trans "Account" %}</th>
                        <th>{% trans "Description" %}</th>
                        <th class="text-end">{% trans "Debit" %}</th>
                        <th class="text-end">{% trans "Credit" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for line in entry.lines.all %}
                    <tr>
                        <td>{{ line.account }}</td>
                        <td>{{ line.description|default:"" }}</td>
                        <td class="text-end">{{ line.debit_amount|default:"0.00" }}</td>
                        <td class="text-end">{{ line.credit_amount|default:"0.00" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="fw-bold">
                    <tr>
                        <td colspan="2" class="text-end">{% trans "TOTAL" %}</td>
                        <td class="text-end">{{ entry.total_debit }}</td>
                        <td class="text-end">{{ entry.total_credit }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        {% if not entry.is_balanced %}
        <div class="alert alert-danger mt-3">
            <i class="bi bi-exclamation-triangle-fill"></i>
            {% trans "This entry is unbalanced! It cannot be posted until Debits equal Credits." %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}