{% load static i18n %}

<nav class="navbar navbar-light navbar-glass navbar-top navbar-expand">
  <button class="btn navbar-toggler-humburger-icon navbar-toggler me-1 me-sm-3" type="button" data-bs-toggle="collapse"
    data-bs-target="#navbarVerticalCollapse" aria-controls="navbarVerticalCollapse" aria-expanded="false"
    aria-label="Toggle Navigation"><span class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>
  <a class="navbar-brand me-1 me-sm-3" href="/">
    <div class="d-flex align-items-center py-3">
      <picture>
        <source srcset="{% static 'app/img/TicTacFlow_logo_dark.png' %}" media="(prefers-color-scheme: dark)">
        <img class="me-2" src="{% static 'app/img/TicTacFlow_logo.png' %}" alt="TicTacFlow Solutions" width="100" />
      </picture>
      <!-- <span class="font-sans-serif">falcon</span> -->
    </div>
  </a>
  <ul class="navbar-nav align-items-center d-none d-lg-block">
    <li class="nav-item">
      <!-- <div class="search-box" data-list='{"valueNames":["title"]}'> -->
      <div class="search-box">
        <form class="position-relative" data-bs-toggle="search" data-bs-display="static">
          <!-- <input class="form-control search-input fuzzy-search" type="search" placeholder="Search " aria-label="Search" id="search-routers"/> -->
          <!-- <span class="fas fa-search search-box-icon"></span> -->
        </form>
        <div class="btn-close-falcon-container position-absolute end-0 top-50 translate-middle shadow-none"
          data-bs-dismiss="search">
          <div class="btn-close-falcon" aria-label="Close"></div>
        </div>
      </div>
    </li>

    <!-- Company Switcher -->
    {% if user_companies and user_companies|length > 1 %}
    <li class="nav-item dropdown ms-2">
      <button class="btn btn-sm btn-falcon-default dropdown-toggle" id="companyDropdown" type="button"
        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {% if active_company %}{{ active_company.name }}{% else %}Select Company{% endif %}
      </button>
      <div class="dropdown-menu dropdown-menu-end py-0" aria-labelledby="companyDropdown">
        <div class="bg-white dark__bg-1000 rounded-2 py-2">
          {% for company in user_companies %}
          <form action="#" method="post" class="d-inline">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <button class="dropdown-item {% if active_company.pk == company.pk %}fw-bold{% endif %}" type="submit">
              {{ company.name }}
            </button>
          </form>
          {% endfor %}
        </div>
      </div>
    </li>
    {% elif active_company %}
    <li class="nav-item ms-2">
      <span class="badge badge-soft-primary">{{ active_company.name }}</span>
    </li>
    {% endif %}

    <li class="nav-item">
      <button class="btn btn-sm btn-falcon-default w-50">
        <span class="fs--2">
          {% if request.user.is_authenticated %}
          {{ request.user.email }}
          {% else %}
          Guest
          {% endif %}
        </span>
      </button>
    </li>
  </ul>
  <ul class="navbar-nav navbar-nav-icons ms-auto flex-row align-items-center">
    <li class="nav-item">
      <div class="theme-control-toggle fa-icon-wait px-2">
        <input class="form-check-input ms-0 theme-control-toggle-input" id="themeControlToggle" type="checkbox"
          data-theme-control="theme" value="dark" />
        <label class="mb-0 theme-control-toggle-label theme-control-toggle-light" for="themeControlToggle"
          data-bs-toggle="tooltip" data-bs-placement="left" title="Switch to light theme"><span
            class="fas fa-sun fs-0"></span></label>
        <label class="mb-0 theme-control-toggle-label theme-control-toggle-dark" for="themeControlToggle"
          data-bs-toggle="tooltip" data-bs-placement="left" title="Switch to dark theme"><span
            class="fas fa-moon fs-0"></span></label>
      </div>
    </li>
    <li class="nav-item dropdown">
      <a class="nav-link notification-indicator notification-indicator-primary px-0 fa-icon-wait"
        id="navbarDropdownNotification" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
        aria-expanded="false" data-hide-on-body-scroll="data-hide-on-body-scroll"><span class="fas fa-bell"
          data-fa-transform="shrink-6" style="font-size: 33px;"></span></a>
      <div class="dropdown-menu dropdown-menu-end dropdown-menu-card dropdown-menu-notification dropdown-caret-bg"
        aria-labelledby="navbarDropdownNotification">
      </div>

    </li>

    {% if on != 'switch' %}
    {% if user.user_account.count > 1 %}
    <li class="nav-item dropdown">
      <a class="nav-link fa-icon-wait nine-dots p-1" id="navbarDropdownMenu" role="button"
        data-hide-on-body-scroll="data-hide-on-body-scroll" data-bs-toggle="dropdown" aria-haspopup="true"
        aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="43" viewBox="0 0 16 16" fill="none">
          <circle cx="2" cy="2" r="2" fill="#6C6E71"></circle>
          <circle cx="2" cy="8" r="2" fill="#6C6E71"></circle>
          <circle cx="2" cy="14" r="2" fill="#6C6E71"></circle>
          <circle cx="8" cy="8" r="2" fill="#6C6E71"></circle>
          <circle cx="8" cy="14" r="2" fill="#6C6E71"></circle>
          <circle cx="14" cy="8" r="2" fill="#6C6E71"></circle>
          <circle cx="14" cy="14" r="2" fill="#6C6E71"></circle>
          <circle cx="8" cy="2" r="2" fill="#6C6E71"></circle>
          <circle cx="14" cy="2" r="2" fill="#6C6E71"></circle>
        </svg>
      </a>
      <div class="dropdown-menu dropdown-caret dropdown-caret dropdown-menu-end dropdown-menu-card dropdown-caret-bg"
        aria-labelledby="navbarDropdownMenu">
        <div class="card shadow-none">
          <div class="card-body px-1">
            <div class="row text-center gx-0 gy-0">
              <div class="col-12"><a class="btn btn-outline-primary btn-sm mt-4" href="#">Switch Profile</a></div>
            </div>
          </div>
        </div>
      </div>
    </li>

    {% endif %}
    {% endif %}

    {# Language Switcher - follows TestDriven.io i18n guide #}
    {% get_current_language as CURRENT_LANGUAGE %}
    {% get_available_languages as AVAILABLE_LANGUAGES %}
    {% get_language_info_list for AVAILABLE_LANGUAGES as languages %}
    <li class="nav-item dropdown me-2">
      <button class="btn btn-sm btn-falcon-default dropdown-toggle" type="button" id="languageDropdown"
        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-globe me-1"></i>{{ CURRENT_LANGUAGE|upper }}
      </button>
      <div class="dropdown-menu dropdown-menu-end py-2" aria-labelledby="languageDropdown">
        {% for language in languages %}
        <form action="{% url 'set_language' %}" method="post" class="d-block m-0 p-0">
          {% csrf_token %}
          <input type="hidden" name="language" value="{{ language.code }}">
          <input type="hidden" name="next" value="{{ request.get_full_path }}">
          <button type="submit"
            class="dropdown-item {% if language.code == CURRENT_LANGUAGE %}fw-bold text-primary{% endif %}">
            {{ language.name_local }}
            {% if language.code == CURRENT_LANGUAGE %}
            <i class="fas fa-check small"></i>
            {% endif %}
          </button>
        </form>
        {% endfor %}
      </div>
    </li>

    <li class="nav-item dropdown"><a class="nav-link pe-0 ps-2" id="navbarDropdownUser" role="button"
        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <div class="avatar avatar-xl">
          {% if user.avatar %}
          <img class="rounded-circle" src="" alt="" />
          {% else %}
          <img class="rounded-circle" src="" alt="" />
          {% endif %}
        </div>
      </a>
      <div class="dropdown-menu dropdown-menu-end py-0" aria-labelledby="navbarDropdownUser">
        <div class="bg-white dark__bg-1000 rounded-2 py-2">
          <a class="dropdown-item fw-bold text-warning" href="#"><span class="fas fa-user me-1"></span><span>{{
              user.username }}</span></a>

          <div class="dropdown-divider"></div>
          {% if on != 'switch' %}
          <a class="dropdown-item" href="{% url 'users:profile' %}">Profile</a>
          <div class="dropdown-divider"></div>
          {% endif %}
          <a class="dropdown-item" href="{% url 'account_logout' %}">Logout</a>
        </div>
      </div>
    </li>
  </ul>
</nav>